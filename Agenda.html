<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AGENDA</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 600px;
            margin: 20px 0;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
        }
        input[type="text"], input[type="number"], input[type="email"] {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }
        textarea {
            width: 100%;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            resize: vertical;
        }
        h1 {
            color: #333;
        }
        .botones {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #45a049;
        }
        .btn-guardar {
            background-color: #008CBA;
        }
        .btn-guardar:hover {
            background-color: #007399;
        }
        .btn-limpiar {
            background-color: #f44336;
        }
        .btn-limpiar:hover {
            background-color: #da190b;
        }
        .btn-eliminar {
            background-color: #ff9800;
        }
        .btn-eliminar:hover {
            background-color: #e68900;
        }
        .btn-exportar {
            background-color: #9c27b0;
        }
        .btn-exportar:hover {
            background-color: #7b1fa2;
        }
        .mensaje {
            margin: 10px 0;
            padding: 10px;
            border-radius: 4px;
            font-weight: bold;
        }
        .exito {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .datos-guardados {
            margin-top: 30px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            max-width: 600px;
        }
        .datos-guardados h3 {
            margin-top: 0;
            color: #495057;
        }
    </style>
</head>
<body>
    <h1>AGENDA - RECOGIDA - FAC</h1>
    
    <table>
        <thead>
            <tr>
                <th>Campo</th>
                <th>Valor</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Nombre Completo:</td>
                <td><input type="text" id="nombre" name="nombre" placeholder="Introduce tu nombre completo"></td>
            </tr>
            <tr>
                <td>Direcci√≥n:</td>
                <td><input type="text" id="direccion" name="direccion" placeholder="Calle y n√∫mero"></td>
            </tr>
            <tr>
                <td>Tel√©fono:</td>
                <td><input type="number" id="telefono" name="telefono" placeholder="N√∫mero de tel√©fono"></td>
            </tr>
            <tr>
                <td>Email:</td>
                <td><input type="email" id="email" name="email" placeholder="correo@ejemplo.com"></td>
            </tr>
            <tr>
                <td>Texto de Cosula:</td>
                <td><textarea id="observaciones" name="observaciones" rows="4" placeholder="Escribe tus observaciones aqu√≠..."></textarea></td>
            </tr>
        </tbody>
    </table>

    <div class="botones">
        <button onclick="guardarDatos()" class="btn-guardar">üíæ Guardar Datos</button>
        <button onclick="limpiarFormulario()" class="btn-limpiar">üóëÔ∏è Limpiar Formulario</button>
        <button onclick="eliminarDatosGuardados()" class="btn-eliminar">‚ùå Eliminar Datos Guardados</button>
        <button onclick="Descargar_csv()" class="btn-exportar">üì§ Exportar Datos</button>
    </div>

    <div id="mensaje" class="mensaje" style="display: none;"></div>

    <div id="datos-guardados" class="datos-guardados" style="display: none;">
        <h3>üìã Datos Guardados:</h3>
        <div id="contenido-datos"></div>
    </div>>

    <script>
        // Clave para localStorage
        const CLAVE_STORAGE = 'agenda_datos';

        // Funci√≥n para cargar datos guardados al iniciar la p√°gina
        function cargarDatosGuardados() {
            const datosGuardados = localStorage.getItem(CLAVE_STORAGE);
            if (datosGuardados) {
                try {
                    const datos = JSON.parse(datosGuardados);
                    // Llenar los campos del formulario
                    document.getElementById('nombre').value = datos.nombre || '';
                    document.getElementById('direccion').value = datos.direccion || '';
                    document.getElementById('telefono').value = datos.telefono || '';
                    document.getElementById('email').value = datos.email || '';
                    document.getElementById('observaciones').value = datos.observaciones || '';
                    
                    // Mostrar los datos guardados
                    mostrarDatosGuardados(datos);
                } catch (error) {
                    console.error('Error al cargar datos guardados:', error);
                }
            }
        }

        // Funci√≥n para guardar datos
        function guardarDatos() {
            // Capturar datos del formulario
            const datos = {
                nombre: document.getElementById('nombre').value,
                direccion: document.getElementById('direccion').value,
                telefono: document.getElementById('telefono').value,
                email: document.getElementById('email').value,
                observaciones: document.getElementById('observaciones').value,
                fecha_guardado: new Date().toLocaleString('es-ES')
            };

            // Validar que al menos el nombre est√© presente
            if (!datos.nombre.trim()) {
                mostrarMensaje('‚ö†Ô∏è Por favor, introduce al menos el nombre antes de guardar.', 'error');
                return;
            }

            try {
                // Guardar en localStorage
                localStorage.setItem(CLAVE_STORAGE, JSON.stringify(datos));
                
                // Mostrar mensaje de √©xito
                mostrarMensaje('‚úÖ ¬°Datos guardados correctamente! Se recordar√°n cuando abras la p√°gina nuevamente.', 'exito');
                
                // Actualizar la visualizaci√≥n de datos guardados
                mostrarDatosGuardados(datos);
                
            } catch (error) {
                console.error('Error al guardar:', error);
                mostrarMensaje('‚ùå Error al guardar los datos. Verifica el almacenamiento del navegador.', 'error');
            }
        }

        // Funci√≥n para mostrar mensaje temporal
        function mostrarMensaje(texto, tipo) {
            const mensajeDiv = document.getElementById('mensaje');
            mensajeDiv.textContent = texto;
            mensajeDiv.className = `mensaje ${tipo}`;
            mensajeDiv.style.display = 'block';
            
            // Ocultar mensaje despu√©s de 5 segundos
            setTimeout(() => {
                mensajeDiv.style.display = 'none';
            }, 5000);
        }

        // Funci√≥n para mostrar datos guardados
        function mostrarDatosGuardados(datos) {
            const contenedor = document.getElementById('datos-guardados');
            const contenido = document.getElementById('contenido-datos');
            
            contenido.innerHTML = `
                <strong>Nombre Completo:</strong> ${datos.nombre || 'No especificado'}<br>
                <strong>Direcci√≥n:</strong> ${datos.direccion || 'No especificado'}<br>
                <strong>Tel√©fono:</strong> ${datos.telefono || 'No especificado'}<br>
                <strong>Email:</strong> ${datos.email || 'No especificado'}<br>
                <strong>Texto de Cosula:</strong> ${datos.observaciones || 'No especificado'}<br>
                <strong>Fecha de guardado:</strong> ${datos.fecha_guardado || 'No disponible'}
            `;
            contenedor.style.display = 'block';
        }

        // Funci√≥n para limpiar formulario
        function limpiarFormulario() {
            if (confirm('¬øEst√°s seguro de que quieres limpiar todos los campos?')) {
                document.getElementById('nombre').value = '';
                document.getElementById('direccion').value = '';
                document.getElementById('telefono').value = '';
                document.getElementById('email').value = '';
                document.getElementById('observaciones').value = '';
                mostrarMensaje('üßπ Formulario limpiado correctamente.', 'exito');
            }
        }

        // Funci√≥n para eliminar datos guardados
        function eliminarDatosGuardados() {
            if (confirm('¬øEst√°s seguro de que quieres eliminar todos los datos guardados? Esta acci√≥n no se puede deshacer.')) {
                localStorage.removeItem(CLAVE_STORAGE);
                document.getElementById('datos-guardados').style.display = 'none';
                mostrarMensaje('üóëÔ∏è Datos guardados eliminados correctamente.', 'exito');
            }
        }

        // Funci√≥n para exportar datos a archivo de texto
        function Descargar_csv() {
            const nombre = document.getElementById('nombre').value.trim() || 'agenda_datos';
           
            // Capturar todos los datos actuales del formulario
            const datos = {
                nombre: document.getElementById('nombre').value,
                direccion: document.getElementById('direccion').value,
                telefono: document.getElementById('telefono').value,
                email: document.getElementById('email').value,
                observaciones: document.getElementById('observaciones').value
            };

            // Crear contenido del archivo
            const contenido = `AGENDA - RECOGIDA - FAC

Nombre Completo: ${datos.nombre}
Direcci√≥n: ${datos.direccion}
Tel√©fono: ${datos.telefono}
Email: ${datos.email}

Texto de Cosula:
${datos.observaciones}

Fecha de exportaci√≥n: ${new Date().toLocaleString('es-ES')}
===============================`;

            // Crear y descargar archivo
            const blob = new Blob([contenido], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);

            const enlace = document.createElement('a');
            enlace.href = url;
            enlace.download = `${nombre.replace(/[^a-zA-Z0-9]/g, '_')}.csv`;

            document.body.appendChild(enlace);
            enlace.click();
            document.body.removeChild(enlace);
            URL.revokeObjectURL(url);

            mostrarMensaje('üì§ Datos exportados correctamente a archivo de texto.', 'exito');
        }

        // Cargar datos guardados al iniciar la p√°gina
        window.onload = function() {
            cargarDatosGuardados();
        };

        // Event listeners para guardado autom√°tico (opcional)
        const campos = ['nombre', 'direccion', 'telefono', 'email', 'observaciones'];
        campos.forEach(campo => {
            document.getElementById(campo).addEventListener('blur', function() {
                // Guardar autom√°ticamente despu√©s de 3 segundos de inactividad si hay contenido
                clearTimeout(window.autosaveTimeout);
                if (document.getElementById('nombre').value.trim()) {
                    window.autosaveTimeout = setTimeout(() => {
                        guardarDatos();
                    }, 3000);
                }
            });
        });
    </script>
</body>
</html>